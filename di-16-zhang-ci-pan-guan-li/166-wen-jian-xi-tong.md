#### 1、文件系统的介绍

系统分区完成后，将要将分区格式化文件系统（文件系统是个管理软件，存到磁盘分区的某个位置，文件系统不是整个分区）但是文件系统上的数据是在这个分区上的，所以说文件系统是一个管理软件。

文件系统把磁盘分为两片：元数据存储区**\(metadata\)**（inode位图、块位图、inode条目等等）、数据存储区（**数据存储区**又分为多个逻辑存储单元叫做磁盘块（是逻辑概念））

任何文件系统中的数据分为数据和元数据\(metadata\)。数据是指普通文件中的实际数据，而元数据指用来描述一个文件的特征的系统数据，诸如访问权限、文件拥有者以及文件数据块的分布信息\(inode...\)等等。但是元数据中★不包含文件名**★文件名存放在磁盘块上的**。

#### 2、文件系统层次分析

由上而下主要分为用户层、VFS层、文件系统层、缓存层、块设备层、磁盘驱动层、磁盘物理层

用户层：最上面用户层就是我们日常使用的各种程序，需要的接口主要是文件的创建、删除、打开、关闭、写、读等。 

VFS层：我们知道Linux分为用户态和内核态，用户态请求硬件资源需要调用System Call通过内核态去实现。用户的这些文件相关操作都有对应的System Call函数接口，接口调用 VFS对应的函数。 

文件系统层：不同的文件系统实现了VFS的这些函数，通过指针注册到VFS里面。所以，用户的操作通过VFS转到各种文件系统。文件系统把文件读写命令转化为对磁盘LBA的操作，起了一个翻译和磁盘管理的作用。 

缓存层：文件系统底下有缓存，Page Cache，加速性能。对磁盘LBA的读写数据缓存到这里。

块设备层：块设备接口Block Device是用来访问磁盘LBA的层级，读写命令组合之后插入到命令队列，磁盘的驱动从队列读命令执行。Linux设计了电梯算法等对很多LBA的读写进行优化排序，尽量把连续地址放在一起。

磁盘驱动层：磁盘的驱动程序把对LBA的读写命令转化为各自的协议，比如变成ATA命令，SCSI命令，或者是自己硬件可以识别的自定义命令，发送给磁盘控制器。Host Based SSD甚至在块设备层和磁盘驱动层实现了FTL，变成对Flash芯片的操作。 

磁盘物理层：读写物理数据到磁盘介质。



